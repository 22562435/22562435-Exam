---
# IMPORTANT: Change settings here, but DO NOT change the spacing.
# Remove comments and add values where applicable.
# The descriptions below should be self-explanatory

title: "Question 3: Ukraine Conflict"
#subtitle: "This will appear as Right Header"

documentclass: "elsarticle"

# --------- Thesis title (Optional - set to FALSE by default).
# You can move the details below around as you please.
Thesis_FP: FALSE
# Entry1: "An unbelievable study with a title spanning multiple lines."
# Entry2: "\\textbf{Some Guy}" # textbf for bold
# Entry3: "A thesis submitted toward the degree of Doctor of Philosophy"
# Uni_Logo: Tex/Logo.png # Place a logo in the indicated location (from your root, e.g. defaults to ~/Tex/Logo.png) and uncomment this line. Leave uncommented for no image
# Logo_width: 0.3 # If using a logo - use this to set width (size) of image
# Entry4: "Under the supervision of: \\vfill Prof. Joe Smith and Dr. Frank Smith"
# Entry5: "Stellenbosch University"
# Entry6: April 2020
# Entry7:
# Entry8:

# --------- Front Page
# Comment: ----- Follow this pattern for up to 5 authors
AddTitle: TRUE # Use FALSE when submitting to peer reviewed platform. This will remove author names.
Author1: "Liam Andrew Beattie"  # First Author - note the thanks message displayed as an italic footnote of first page.
Ref1: "Data Science Exam, Stellenbosch University" # First Author's Affiliation
Email1: "22562435\\@sun.ac.za" # First Author's Email address

#Author2: "John Smith"
#Ref2: "Some other Institution, Cape Town, South Africa"
#Email2: "John\\@gmail.com"
#CommonAffiliation_12: TRUE # If Author 1 and 2 have a common affiliation. Works with _13, _23, etc.

#Author3: "John Doe"
#Email3: "Joe\\@gmail.com"

#CorrespAuthor_1: TRUE  # If corresponding author is author 3, e.g., use CorrespAuthor_3: TRUE

# Comment out below to remove both. JEL Codes only given if keywords also given.
#keywords: "Multivariate GARCH \\sep Kalman Filter \\sep Copula" # Use \\sep to separate
#JELCodes: "L250 \\sep L100"

# ----- Manage headers and footers:
#BottomLFooter: $Title$
#BottomCFooter:
#TopLHeader: \leftmark # Adds section name at topleft. Remove comment to add it.
BottomRFooter: "\\footnotesize Page \\thepage" # Add a '#' before this line to remove footer.
addtoprule: TRUE
addfootrule: TRUE               # Use if footers added. Add '#' to remove line.

# --------- page margins:
margin: 2.3 # Sides
bottom: 2 # bottom
top: 2.5 # Top
HardSet_layout: TRUE # Hard-set the spacing of words in your document. This will stop LaTeX squashing text to fit on pages, e.g.
# This is done by hard-setting the spacing dimensions. Set to FALSE if you want LaTeX to optimize this for your paper.

# --------- Line numbers
linenumbers: FALSE # Used when submitting to journal

# ---------- References settings:
# You can download cls format here: https://www.zotero.org/ - simply search for your institution. You can also edit and save cls formats here: https://editor.citationstyles.org/about/
# Hit download, store it in Tex/ folder, and change reference below - easy.
bibliography: Tex/ref.bib       # Do not edit: Keep this naming convention and location.
csl: Tex/harvard-stellenbosch-university.csl # referencing format used.
# By default, the bibliography only displays the cited references. If you want to change this, you can comment out one of the following:
#nocite: '@*' # Add all items in bibliography, whether cited or not
 # nocite:  
 # @oecd_cpi_japan for CPI 
 # @oecd_monetary_aggregates_japan 
 # @oecd_production_volume_japan 
 # @oecd_interest_rates_japan | # add specific references that aren't cited
#  @grinold2000
#  @Someoneelse2010

# ---------- General:
RemovePreprintSubmittedTo: TRUE  # Removes the 'preprint submitted to...' at bottom of titlepage
Journal: "Journal of Finance"   # Journal that the paper will be submitting to, if RemovePreprintSubmittedTo is set to TRUE.
toc: FALSE                       # Add a table of contents
numbersections: TRUE             # Should sections (and thus figures and tables) be numbered?
fontsize: 11pt                  # Set fontsize
linestretch: 1.2                # Set distance between lines.
link-citations: TRUE            # This creates dynamic links to the papers in reference list.

### Adding additional latex packages:
# header-includes:
#    - \usepackage{colortbl} # Add additional packages here.

output:
  pdf_document:
    keep_tex: TRUE
    template: Tex/TexDefault.txt
    fig_width: 3.5 # Adjust default figure sizes. This can also be done in the chunks of the text.
    fig_height: 3.5

---

<!-- First: Set your default preferences for chunk options: -->

<!-- If you want a chunk's code to be printed, set echo = TRUE. message = FALSE stops R printing ugly package loading details in your final paper too. I also suggest setting warning = FALSE and checking for warnings in R, else you might find ugly warnings in your paper. -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 6, fig.height = 5, fig.pos="H", fig.pos = 'H')

rm(list = ls()) # Clean your environment:
gc() # garbage collection - It can be useful to call gc after a large object has been removed, as this may prompt R to return memory to the operating system.
library(tidyverse)
list.files('code/', full.names = T, recursive = T) %>% .[grepl('.R', .)] %>% as.list() %>% walk(~source(.))
data<-import_multiple_csv_and_join("data/Ukraine_Aid/.")

```

```{r}
install.packages(c("leaflet", "dplyr", "rnaturalearth", "sf"))

```
```{r}
library(leaflet)
library(dplyr)
library(rnaturalearth)
library(sf)

```


```{r}
# Load world map data
world <- ne_countries(scale = "medium", returnclass = "sf")

# Prepare your data (ensure the column names match for joining)
data <- data %>%
  rename(TotalBilateralAllocations = `Total.bilateral.allocations...billion.`)

# Join your data with the geographic data
map_data <- world %>%
  left_join(data, by = c("name" = "Country"))

```






```{r}
# Create color palette
pal <- colorNumeric(palette = "YlGnBu", domain = map_data$TotalBilateralAllocations, na.color = "transparent")

# Create the leaflet map
leaflet(map_data) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(TotalBilateralAllocations),
    weight = 1,
    opacity = 1,
    color = "white",
    dashArray = "3",
    fillOpacity = 0.7,
    highlightOptions = highlightOptions(
      weight = 5,
      color = "#666",
      dashArray = "",
      fillOpacity = 0.7,
      bringToFront = TRUE),
    label = ~paste(name, ": ", TotalBilateralAllocations, " billion"),
    labelOptions = labelOptions(
      style = list("font-weight" = "normal", padding = "3px 8px"),
      textsize = "15px",
      direction = "auto")
  ) %>%
  addLegend(pal = pal, values = ~TotalBilateralAllocations, opacity = 0.7, title = "Total Bilateral Allocations (billion)",
            position = "bottomright")

```



































































































Okay so I have an idea. It is a map of all the countries in the database. I want countries not in database to be gray, and then all the other countries to be on a fill scale from from "#5f695a" to "#1e0f54" for their "Total Bilateral Allocations". Additionally I want countries who are in the European Union to be have a texture on top of it. 

Again this is my database:
> summary(data)
   Country            EU.member      Financial.allocations...billion. Humanitarian.allocations...billion.
 Length:42          Min.   :0.0000   Min.   : 0.00000                 Min.   :0.00000                    
 Class :character   1st Qu.:0.0000   1st Qu.: 0.00000                 1st Qu.:0.01193                    
 Mode  :character   Median :1.0000   Median : 0.04339                 Median :0.06488                    
                    Mean   :0.6429   Mean   : 1.82504                 Mean   :0.37409                    
                    3rd Qu.:1.0000   3rd Qu.: 0.73809                 3rd Qu.:0.37783                    
                    Max.   :1.0000   Max.   :29.65689                 Max.   :3.26385                    
                                     NA's   :2                        NA's   :2                          
 Military.allocations...billion. Total.bilateral.allocations...billion. Share.in.EU.allocations...billion.
 Min.   : 0.00000                Min.   : 0.00217                       Min.   :0.0000                    
 1st Qu.: 0.00399                1st Qu.: 0.08360                       1st Qu.:0.0000                    
 Median : 0.18769                Median : 0.67148                       Median :0.1004                    
 Mean   : 2.27434                Mean   : 4.47347                       Mean   :0.5490                    
 3rd Qu.: 1.14829                3rd Qu.: 3.64134                       3rd Qu.:0.4912                    
 Max.   :46.15200                Max.   :71.85883                       Max.   :5.6896                    
 NA's   :2                       NA's   :2                              NA's   :4                         
 GDP.in.2021...billion. Financial.commitments...billion. Humanitarian.commitments...billion. Military.commitments...billion.
 Min.   :   17.36       Min.   : 0.00000                 Min.   :0.00000                     Min.   : 0.0000                
 1st Qu.:  132.86       1st Qu.: 0.00000                 1st Qu.:0.01306                     1st Qu.: 0.0042                
 Median :  493.18       Median : 0.04339                 Median :0.09140                     Median : 0.2329                
 Mean   : 2265.64       Mean   : 3.29614                 Mean   :0.45606                     Mean   : 2.8583                
 3rd Qu.: 1746.38       3rd Qu.: 0.72081                 3rd Qu.:0.38444                     3rd Qu.: 1.8962                
 Max.   :23315.08       Max.   :82.69119                 Max.   :3.26385                     Max.   :46.3256                
                                                                                                                            
 Total.bilateral.commitments...billion. Share.in.EU.commitments...billion. Specific.weapons.and.equipment...billion.
 Min.   : 0.00217                       Min.   : 0.0000                    Min.   : 0.00000                         
 1st Qu.: 0.09675                       1st Qu.: 0.0000                    1st Qu.: 0.00358                         
 Median : 0.91655                       Median : 0.3036                    Median : 0.14324                         
 Mean   : 6.61049                       Mean   : 1.9669                    Mean   : 2.81980                         
 3rd Qu.: 4.43676                       3rd Qu.: 1.5862                    3rd Qu.: 1.56880                         
 Max.   :85.14094                       Max.   :18.8263                    Max.   :46.32560                         
                                                                           NA's   :1                                
 Financial.commitments.with.military.purpose...billion. Total.bilateral.commitments.of.short.term...billion.
 Min.   :0.00000                                        Min.   : 0.00217                                    
 1st Qu.:0.00000                                        1st Qu.: 0.08628                                    
 Median :0.00000                                        Median : 0.82825                                    
 Mean   :0.09480                                        Mean   : 5.29167                                    
 3rd Qu.:0.03214                                        3rd Qu.: 3.78907                                    
 Max.   :1.41686                                        Max.   :75.40243                                    
 NA's   :1                                              NA's   :1  
 
 with Show in New Window
R Console

Error: 'kable_styling' is not an exported object from 'namespace:knitr'
> unique(data$Country)
 [1] "Australia"                   "Austria"                     "Belgium"                     "Bulgaria"                   
 [5] "Canada"                      "Croatia"                     "Cyprus"                      "Czech Republic"             
 [9] "Denmark"                     "Estonia"                     "Finland"                     "France"                     
[13] "Germany"                     "Greece"                      "Hungary"                     "Iceland"                    
[17] "Ireland"                     "Italy"                       "Japan"                       "Latvia"                     
[21] "Lithuania"                   "Luxembourg"                  "Malta"                       "Netherlands"                
[25] "New Zealand"                 "Norway"                      "Poland"                      "Portugal"                   
[29] "South Korea"                 "Romania"                     "Slovakia"                    "Slovenia"                   
[33] "Spain"                       "Sweden"                      "Switzerland"                 "Turkey"                     
[37] "United Kingdom"              "United States"               "China"                       "Taiwan"                     
[41] "India"                       "EU (Commission and Council)"

```{r}
# Load necessary libraries
library(sf)
library(ggplot2)
library(dplyr)
library(rnaturalearth)
# Assuming you have a dataset named 'data' with relevant columns
# Adjust as per your actual data structure and column names

# Load world map data
world <- ne_countries(scale = "medium", returnclass = "sf")

# Merge world map data with your dataset
world_data <- merge(world, data, by.x = "name", by.y = "Country", all.x = TRUE)

# Define color palette for Total bilateral allocations
palette <- colorRampPalette(c("#0066cc", "#ffcc00"))

# Create the plot
ggplot() +
  geom_sf(data = world_data, aes(fill = Total.bilateral.allocations...billion.)) +
  scale_fill_gradientn(colors = palette(10), na.value = "#D3D3D3", name = "Total Bilateral Allocations (billion $)") +
  theme_minimal() +
  labs(title = "Total Bilateral Allocations for Ukraine Support",
       ylab="",
       xlab="") +
  theme(legend.position = "bottom") +
  guides(fill = guide_colorbar(barwidth = 10, barheight = 0.5, title.position = "top")) +
  geom_sf(data = filter(world_data, EU.member == 1), fill = NA, color = "black", lwd = 0.3, pattern = "stripe") +
  annotate("text", x = -120, y = 60, label = "EU Member", size = 3, color = "black")

# Note: Adjust annotate("text", x = ..., y = ...) to position the EU Member label appropriately


```

```{r}
# Load necessary libraries
library(sf)
library(ggplot2)
library(dplyr)

# Assuming you have a dataset named 'data' with relevant columns
# Adjust as per your actual data structure and column names

# Load world map data
world <- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf")

# Filter for European countries
european_countries <- world %>%
  filter(continent == "Europe")

# Merge with your dataset
# Filter for continental Europe
european_data <- world %>%
  filter(subregion == "Western Europe" | subregion == "Eastern Europe" | subregion == "Northern Europe" | subregion == "Southern Europe")

# Merge with your dataset (assuming 'data' is your original dataset)
european_data <- merge(european_data, data, by.x = "name", by.y = "Country", all.x = TRUE)


# Create the plot
ggplot() +
  geom_sf(data = european_data, aes(fill = Total.bilateral.allocations...billion.)) +
  scale_fill_gradientn(colors = palette(10), na.value = "#D3D3D3", name = "Total Bilateral Allocations (billion $)") +
  theme_minimal() +
  labs(title = "Total Bilateral Allocations for Ukraine Support (European Countries)") +
  theme(legend.position = "bottom") +
  guides(fill = guide_colorbar(barwidth = 10, barheight = 0.5, title.position = "top")) +
  geom_sf(data = filter(european_data, EU.member == 1), fill = NA, color = "black", lwd = 0.3, pattern = "stripe") +
  annotate("text", x = -10, y = 60, label = "EU Member", size = 3, color = "black")

# Note: Adjust annotate("text", x = ..., y = ...) to position the EU Member label appropriately


```


```{r}
ggplot() +
  geom_sf(data = european_data, aes(fill = Total.bilateral.allocations...billion.)) +
  scale_fill_gradientn(colors = palette(10), na.value = "#D3D3D3", name = "Total Bilateral Allocations (billion $)") +
  theme_minimal() +
  labs(title = "Total Bilateral Allocations for Ukraine Support (European Countries)") +
  theme(legend.position = "bottom") +
  guides(fill = guide_colorbar(barwidth = 10, barheight = 0.5, title.position = "top")) +
  geom_sf(data = filter(european_data, EU.member == 1), fill = "transparent", color = "black", lwd = 0.5) +
  annotate("text", x = -10, y = 60, label = "EU Member", size = 3, color = "black")
```




```{r}
# Load necessary libraries
library(sf)
library(ggplot2)
library(dplyr)

# Load world map data
world <- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf")

# Filter for continental Europe and specified longitude and latitude range
european_data <- world %>%
  filter(continent == "Europe" )

# Merge with your dataset (assuming 'data' is your original dataset)
european_data <- merge(european_data, data, by.x = "name", by.y = "Country", all.x = TRUE)

# Define color palette for Total bilateral allocations
palette <- colorRampPalette(c("#0066cc", "#ffcc00"))

# Create the plot
ggplot() +
  geom_sf(data = european_data, aes(fill = Total.bilateral.allocations...billion.)) +
  scale_fill_gradientn(colors = palette(10), na.value = "#D3D3D3", name = "Total Bilateral Allocations (billion $)") +
  theme_minimal() +
  labs(title = "Total Bilateral Allocations for Ukraine Support") +
  theme(legend.position = "bottom") +
  guides(fill = guide_colorbar(barwidth = 10, barheight = 0.5, title.position = "top")) +
  coord_sf(xlim = c(-40, 40), ylim = c(30, 90))  # Adjusting the coordinate system to zoom in

# Note: You can further customize the plot with annotations, labels, and additional layers as needed


```

